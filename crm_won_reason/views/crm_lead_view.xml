<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright 2019 RGB Consulting - Domantas Sidorenkovas
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <record id="action_mark_as_won" model="ir.actions.server">
        <field name="name">Mark as won</field>
        <field name="model_id" ref="model_crm_lead"/>
        <field name="binding_model_id" ref="crm.model_crm_lead"/>
        <field name="state">code</field>
        <field name="code">
        if record:
            action_values = env.ref('crm_won_reason.crm_lead_won_action').read()[0]
            action_values.update({'context': env.context})
            action = action_values
        </field>
    </record>

    <record id="crm_case_form_view_oppor_inherit" model="ir.ui.view">
        <field name="name">crm.lead.form.opportunity.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">
            <field name="lost_reason" position="after">
                <field name="won_reason"
                       attrs="{'invisible': [('probability', '!=', 100)]}"/>
            </field>
        </field>
    </record>

    <record id="view_crm_case_opportunities_filter_inherit" model="ir.ui.view">
        <field name="name">crm.lead.search.opportunity.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
        <field name="arch" type="xml">
            <field name="lost_reason" position="after">
                <field name="won_reason"/>
            </field>
            <filter name="lostreason" position="after">
                <filter string="Won Reason" name="won_reason"
                        context="{'group_by':'won_reason'}"/>
            </filter>
        </field>
    </record>
</odoo>
