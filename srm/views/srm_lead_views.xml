<?xml version="1.0" ?>
<odoo>
    <record id="srm_lead_view_form" model="ir.ui.view">
        <field name="name">crm.lead.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form" />
        <field name="arch" type="xml">
                <xpath
                expr='//group[@name="opportunity_partner"]//field[@name="partner_id"]'
                position='attributes'
            >
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath
                expr='//group[@name="opportunity_partner"]//field[@name="partner_id"]'
                position='before'
            >
                    <field name="request_type" invisible="1" />
                </xpath>
                <xpath
                expr='//group[@name="opportunity_partner"]//field[@name="request_type"]'
                position='after'
            >
                    <field
                    name="partner_id"
                    string="Supplier"
                    attrs="{'invisible': [('request_type','=','customer')]}"
                />
                </xpath>
                <xpath
                expr='//group[@name="opportunity_partner"]//field[@name="request_type"]'
                position='after'
            >
                    <field
                    name="partner_id"
                    string="Customer"
                    attrs="{'invisible': [('request_type','!=','customer')]}"
                />
                </xpath>
                <field name="user_id" position="attributes">
                    <attribute name="string">Responsible</attribute>
                </field>
                <field name="team_id" position="attributes">
                    <attribute name="string">Team</attribute>
                </field>
        </field>
    </record>

    <record id="action_lead_rfq_new" model="ir.actions.act_window">
        <field name="name">Lead RFQ new</field>
        <field name="res_model">purchase.order</field>
        <field name="view_mode">form</field>
        <field
            name="context"
        >{'search_default_partner_id': active_id, 'default_partner_id': active_id}</field>
        <field name="groups_id" eval="[(4, ref('purchase.group_purchase_user'))]" />
    </record>


    <record id="crm_case_form_view_oppor" model="ir.ui.view">
        <field name="name">crm.lead.oppor.inherited.crm</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor" />
        <field name="arch" type="xml">
            <xpath
                expr="//button[@name='action_sale_quotations_new']"
                position="attributes"
            >
                <attribute
                    name="attrs"
                >{'invisible': ['|', ('request_type', '=', 'supplier'), '|', ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='action_set_won_rainbowman']" position="before">
                <button
                    string="New RFQ"
                    name="action_lead_rfq_new"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': ['|', ('request_type', '!=', 'supplier'), '|', ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False)]}"
                />
            </xpath>
            <xpath
                expr="//button[@name='action_view_sale_quotation']"
                position="attributes"
            >
                <attribute
                    name="attrs"
                >{'invisible': ['|', ('request_type', '=', 'supplier'), ('type', '=', 'lead')]}</attribute>
            </xpath>
            <xpath
                expr="//button[@name='action_view_sale_order']"
                position="attributes"
            >
                <attribute
                    name="attrs"
                >{'invisible': ['|', '|', ('request_type', '=', 'supplier'), ('sale_order_count', '=', 0), ('type', '=', 'lead')]}</attribute>
            </xpath>

            <button name="action_schedule_meeting" position="after">
                <button
                    class="oe_stat_button"
                    type="object"
                    name="action_view_sale_quotation"
                    icon="fa-pencil-square-o"
                    attrs="{'invisible': [('type', '=', 'lead')]}"
                >
                    <field
                        name="request_for_quotation_count"
                        widget="statinfo"
                        string="RFQs"
                    />
                </button>
                <button
                    class="oe_stat_button"
                    type="object"
                    attrs="{'invisible': ['|', ('purchase_amount_total', '=', 0), ('type', '=', 'lead')]}"
                    name="action_view_sale_order"
                    icon="fa-usd"
                >
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value"><field
                                name="purchase_amount_total"
                                widget="monetary"
                                options="{'currency_field': 'company_currency'}"
                            /></span>
                        <span class="o_stat_text"> Purchase Orders</span>
                        <field name="purchase_order_count" invisible="1" />
                    </div>
                </button>
            </button>

        </field>
    </record>
    <record id="quick_create_opportunity_form" model="ir.ui.view">
        <field name="name">srm.lead.form.quick_create</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.quick_create_opportunity_form" />
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="request_type" invisible="1" />
            </field>
        </field>
    </record>

    <!-- Lead Menu -->
    <record id="srm_lead_action_pipeline" model="ir.actions.act_window">
        <field name="name">Srm: Pipeline</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">kanban,tree,graph,pivot,form,calendar,activity</field>
        <field
            name="domain"
        >[('type','=','opportunity'), ('request_type','=', 'supplier')]</field>
        <field name="context">{
                'default_type': 'opportunity',
                'search_default_assigned_to_me': 1,
                'default_request_type': 'supplier',
        }</field>
        <field name="search_view_id" ref="crm.view_crm_case_opportunities_filter" />
    </record>

    <record id="action_your_pipeline" model="ir.actions.server">
        <field name="name">Srm: My Pipeline</field>
        <field name="model_id" ref="crm.model_crm_team" />
        <field name="state">code</field>
        <field name="groups_id" eval="[(4, ref('base.group_user'))]" />
        <field
            name="code"
        >action = model.with_context(request_type='supplier').action_your_pipeline()</field>
    </record>

    <!-- Leads -->
    <record id="srm_lead_all_leads" model="ir.actions.act_window">
        <field name="name">Leads</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">tree,kanban,graph,pivot,calendar,form,activity</field>
        <field
            name="domain"
        >['&amp;','|', ('type','=','lead'), ('type','=',False), ('request_type', '=', 'supplier')]</field>
        <field name="search_view_id" ref="crm.view_crm_case_leads_filter" />
        <field name="context">{
                'default_type':'lead',
                'default_request_type': 'supplier',
                'search_default_type': 'lead',
                'search_default_to_process':1,
            }
        </field>
    </record>

    <!-- dashboard action -->
    <record id="srm_lead_action_dashboard" model="ir.actions.act_window">
        <field name="name">Srm Leads Analysis</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">dashboard,pivot,graph,tree</field>
        <field
            name="domain"
        >['&amp;', ('request_type','=', 'supplier'),  '|', ('active','=',True), ('active','=',False)]</field>
        <field name="search_view_id" ref="crm.view_crm_case_leads_filter" />
        <field name="context" eval="{'search_default_filter_creation_date': 1}" />
    </record>

    <record id="srm_opportunity_action_dashboard" model="ir.actions.act_window">
        <field name="name">Pipeline Analysis</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">dashboard,pivot,graph,tree,form,cohort</field>
        <field name="domain">[('request_type','=', 'supplier')]</field>
        <field
            name="context"
            eval="{
            'tree_view_ref': 'crm.crm_case_tree_view_oppor',
            'default_type': 'opportunity',
            'search_default_opportunity': True,
            'search_default_filter_create_date': 1}"
        />
        <field name="search_view_id" ref="crm_enterprise.crm_opportunity_view_search" />
    </record>


    <!-- menuitem -->
    <record id="srm_menu_root" model="ir.ui.menu">
        <field name="action" ref="srm.srm_lead_action_pipeline" />
    </record>

    <record id="srm_opportunity_report_menu_lead" model="ir.ui.menu">
        <field name="action" ref="srm.srm_lead_action_dashboard" />
    </record>

    <record id="srm_opportunity_report_menu" model="ir.ui.menu">
        <field name="action" ref="srm.srm_opportunity_action_dashboard" />
    </record>

    <record id="srm_menu_leads" model="ir.ui.menu">
        <field name="action" ref="srm.srm_lead_all_leads" />
    </record>

    <record id="menu_srm_opportunities" model="ir.ui.menu">
        <field name="action" ref="srm.action_your_pipeline" />
    </record>
</odoo>
